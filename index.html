<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Collection Tracker</title>
  <meta name="theme-color" content="#7c3aed" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand" id="btnHomeBrand" title="На главную">
      <div class="logo" aria-hidden="true">✦</div>
      <div>
        <div class="title">Collection Tracker</div>
        <div class="subtitle">Открытки • обмены • получение</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button id="btnHome" class="btn ghost" title="Главная">Главная</button>
      <button id="btnExport" class="btn ghost" title="Экспорт данных в JSON">Экспорт</button>
      <label class="btn ghost file">
        Импорт
        <input id="fileImport" type="file" accept="application/json" />
      </label>
      <button id="btnAbout" class="btn ghost" title="Справка">?</button>
    </div>
  </header>

  <main class="app">
    <aside class="sidebar">
      <div class="panel">
        <div class="panel-head">
          <div class="panel-title">Серии</div>
          <button id="btnNewSeries" class="btn primary">＋ Добавить</button>
        </div>
        <div id="seriesList" class="series-list" role="list"></div>
        <div class="hint">
          <div class="hint-title">Быстро</div>
          <ol>
            <li>Создай серию.</li>
            <li>Добавь изображение (это будет <b>Часть 1</b>).</li>
            <li>Выделяй открытки рамкой, отмечай статус и добавляй примечания.</li>
          </ol>
          <div class="hint-small">Данные хранятся на устройстве (IndexedDB). Экспорт/импорт — для бэкапов и переноса.</div>
        </div>
      </div>
    </aside>

    <section class="workspace">
      <div id="homeView" class="home">
        <div class="home-head">
          <div>
            <div class="home-title">Мои серии</div>
            <div class="home-sub">Кликни на серию, чтобы открыть. Прогресс считается по отмеченным открыткам.</div>
          </div>
          <button id="btnNewSeries2" class="btn primary">＋ Добавить серию</button>
        </div>
        <div id="homeGrid" class="home-grid"></div>
        <div id="homeEmpty" class="home-empty hidden">
          <div class="empty-card">
            <div class="empty-title">Добавь первую серию</div>
            <div class="empty-text">Трекер работает как сайт. Можно открыть и на телефоне по ссылке GitHub Pages.</div>
            <button id="btnNewSeries3" class="btn primary">＋ Добавить серию</button>
          </div>
        </div>
      </div>

      <div id="seriesView" class="series-view hidden">
        <div class="series-toolbar">
          <div class="series-group series-group--left">
            <input id="seriesName" class="series-name" type="text" placeholder="Название серии" />
          </div>

          <div class="series-group series-group--center">
            <div class="series-stats" id="seriesStats">—</div>
          </div>

          <div class="series-group series-group--right">
            <div class="series-actions">
              <div class="part-picker">
                <span class="part-label">Часть</span>
                <select id="partSelect" class="select"></select>
              </div>

              <label class="btn">
                ＋ Добавить изображение
                <input id="fileImage" type="file" accept="image/*" />
              </label>

              <button id="btnUndo" class="btn ghost" title="Убрать последнее выделение в текущей части">↶ Отменить</button>
              <button id="btnDeleteSeries" class="btn danger ghost" title="Удалить серию">Удалить серию</button>
            </div>
          </div>
        </div>

        <div class="board">
          <div class="leftcol">
            <div class="canvas-wrap">
              <canvas id="canvas" width="1200" height="800"></canvas>
            </div>

            <div class="canvas-help" id="canvasHelp">
              <div><b>Выделение:</b> потяни рамку по открытке (мышкой или пальцем).</div>
              <div><b>Редактирование:</b> пока только удалить/переделать (выдели заново).</div>
            </div>
          </div>

          <div class="cards">
            <div class="cards-head">
              <div class="cards-title">Открытки</div>

              <div class="cards-controls">
                <div class="chips">
                  <button class="chip active" data-filter="all">Все</button>
                  <button class="chip" data-filter="trade">Обмен найден</button>
                  <button class="chip" data-filter="received">Получено</button>
                  <button class="chip" data-filter="pending">Жду</button>
                </div>

                <div class="part-filter">
                  <span class="part-label">Часть</span>
                  <select id="partFilter" class="select"></select>
                </div>
              </div>
            </div>

            <div id="cardsList" class="cards-list"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <dialog id="dlgNewSeries" class="dialog">
    <form method="dialog" class="dialog-card">
      <div class="dialog-title">Новая серия</div>
      <label class="field">
        <span>Название (необязательно)</span>
        <input id="newSeriesName" type="text" placeholder="Можно оставить пустым" />
      </label>
      <div class="dialog-actions">
        <button class="btn ghost" value="cancel" formnovalidate>Отмена</button>
        <button id="btnCreateSeries" class="btn primary" value="ok">Создать</button>
      </div>
      <div class="dialog-small">Название можно изменить позже.</div>
    </form>
  </dialog>

  <dialog id="dlgConfirm" class="dialog">
    <form method="dialog" class="dialog-card">
      <div class="dialog-title" id="confirmTitle">Подтвердить</div>
      <div class="dialog-text" id="confirmText">—</div>
      <div class="dialog-actions">
        <button class="btn ghost" value="cancel" formnovalidate>Отмена</button>
        <button class="btn danger" id="confirmOk" value="ok">Удалить</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgAbout" class="dialog">
    <form method="dialog" class="dialog-card">
      <div class="dialog-title">Справка</div>
      <div class="dialog-text">
        <p><b>Части:</b> в одной серии может быть несколько изображений (Часть 1, Часть 2...).</p>
        <p><b>Добавление открыток:</b> потяни рамку на изображении — появится карточка справа.</p>
        <p><b>Данные:</b> сохраняются на этом устройстве (IndexedDB). Для переноса используй Экспорт/Импорт.</p>
      </div>
      <div class="dialog-actions">
        <button class="btn primary" value="ok">Ок</button>
      </div>
    </form>
  </dialog>

  <script src="app.js" type="module"></script>
  <div class="version-badge" id="versionBadge">v4.1.1</div>
</body>
</html>
