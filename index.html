<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Collection Tracker</title>
  <meta name="theme-color" content="#7c3aed" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="./favicon.ico" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand" id="btnHomeBrand" title="На главную">
      <div class="logo" aria-hidden="true">✦</div>
      <div>
        <div class="title">Collection Tracker</div>
        <div class="subtitle">Открытки • обмены • получение</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button id="btnHome" class="btn ghost" title="Главная">Главная</button>
      <button id="btnExport" class="btn ghost" title="Экспорт данных в JSON">Экспорт</button>
      <label class="btn ghost file">
        Импорт
        <input id="fileImport" type="file" accept="application/json" />
      </label>
      <button id="btnAbout" class="btn ghost" title="Справка">?</button>
    </div>
  </header>

  <main class="app">
    <aside class="sidebar">
      <div class="panel">
      <div class="panel-head">
        <div class="panel-title">Серии</div>
        <button id="btnNewSeries" class="btn primary">＋ Добавить</button>
      </div>
      <div class="panel-search">
        <span class="search-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none">
            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
            <path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        <input id="seriesSearch" type="search" class="input" placeholder="Поиск серии" aria-label="Поиск серии" />
      </div>
        <div id="seriesList" class="series-list" role="list"></div>
        <div class="hint">
          <div class="hint-title">Быстро</div>
          <ol>
            <li>Создай серию.</li>
            <li>Добавь изображения листов.</li>
            <li>Выделяй открытки рамкой, отмечай статус и добавляй примечания.</li>
          </ol>
          <div class="hint-small">Данные хранятся на устройстве (IndexedDB). Экспорт/импорт — для бэкапов и переноса.</div>
        </div>
      </div>
    </aside>

    <section class="workspace">
      <div id="homeView" class="home">
        <div class="home-head">
          <div>
            <div class="home-title">Мои серии</div>
            <div class="home-sub">Кликни на серию, чтобы открыть. Прогресс считается по отмеченным открыткам.</div>
            <div class="home-count" id="homeCount"></div>
          </div>
          <button id="btnNewSeries2" class="btn primary">＋ Добавить серию</button>
        </div>
        <div class="home-controls">
          <div class="home-sort">
            <span class="home-sort-label">Сортировать</span>
            <select id="homeSortKey" class="select">
              <option value="updated">Дата обновления</option>
              <option value="created">Дата создания</option>
              <option value="completion">Завершенность</option>
              <option value="title">Название</option>
            </select>
            <button id="homeSortDir" class="btn ghost tiny" type="button" aria-label="Сортировка по убыванию">↓</button>
          </div>
        </div>
        <div id="homeGrid" class="home-grid"></div>
        <div id="homeEmpty" class="home-empty hidden">
          <div class="empty-card">
            <div class="empty-title">Добавь первую серию</div>
            <div class="empty-text">Трекер работает как сайт. Можно открыть и на телефоне по ссылке GitHub Pages.</div>
            <button id="btnNewSeries3" class="btn primary">＋ Добавить серию</button>
          </div>
        </div>
      </div>

      <div id="seriesView" class="series-view hidden">
        <div class="series-toolbar">
          <div class="series-toolbar-left">
            <div class="series-title-block">
              <input id="seriesName" class="series-name" type="text" placeholder="Название серии" maxlength="60" />
              <div class="series-stats" id="seriesStats">—</div>
            </div>
          </div>

          <div class="series-toolbar-right">
            <div class="series-actions">
              <div class="series-actions-row">
                <button id="btnUndo" class="btn ghost" title="Убрать последнее выделение">↶ Отменить</button>
                <button id="btnDeleteSeries" class="btn danger ghost" title="Удалить серию">Удалить серию</button>
              </div>
              <div class="series-actions-row">
                <label class="btn">
                  ＋ Добавить изображение
                  <input id="fileImage" type="file" accept="image/*" multiple />
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="board">
          <div class="leftcol" id="seriesLeftcol">
            <div class="dropzone" id="dropzone">
              <div class="dropzone-title">Перетащи изображения сюда или нажми «Добавить изображение»</div>
              <div class="dropzone-sub">Можно загрузить сразу несколько файлов.</div>
            </div>
            <div class="image-blocks" id="imageBlocks"></div>

            <div class="canvas-help" id="canvasHelp">
              <div><b>Выделение:</b> потяни рамку по открытке (мышкой или пальцем).</div>
              <div><b>Редактирование:</b> пока только удалить/переделать (выдели заново).</div>
            </div>
          </div>

          <div class="cards">
            <div class="cards-head">
              <div class="cards-title">Открытки</div>

              <div class="cards-controls">
                <div class="chips">
                  <button class="chip active" data-filter="all">Все</button>
                  <button class="chip" data-filter="trade">Обмен найден</button>
                  <button class="chip" data-filter="received">Получено</button>
                  <button class="chip" data-filter="pending">Жду</button>
                  <button class="chip" data-filter="missing">Не найдено</button>
                </div>

                <div class="cards-controls-right">
                  <div class="toggle-all">
                    <label class="toggle master-toggle">
                      <input id="masterTrade" type="checkbox" />
                      <span>Все: Обмен</span>
                    </label>
                    <label class="toggle master-toggle">
                      <input id="masterReceived" type="checkbox" />
                      <span>Все: Получено</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div id="cardsList" class="cards-list"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <dialog id="dlgNewSeries" class="dialog">
    <form method="dialog" class="dialog-card">
      <div class="dialog-title">Новая серия</div>
      <label class="field">
        <span>Название (необязательно)</span>
        <input id="newSeriesName" type="text" placeholder="Можно оставить пустым" maxlength="60" />
      </label>
      <div class="dialog-actions">
        <button class="btn ghost" value="cancel" formnovalidate>Отмена</button>
        <button id="btnCreateSeries" class="btn primary" value="ok">Создать</button>
      </div>
      <div class="dialog-small">Название можно изменить позже.</div>
    </form>
  </dialog>

  <dialog id="dlgConfirm" class="dialog">
    <form method="dialog" class="dialog-card">
      <div class="dialog-title" id="confirmTitle">Подтвердить</div>
      <div class="dialog-text" id="confirmText">—</div>
      <div class="dialog-actions">
        <button class="btn ghost" value="cancel" formnovalidate>Отмена</button>
        <button class="btn danger" id="confirmOk" value="ok">Удалить</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgAbout" class="dialog">
    <form method="dialog" class="dialog-card">
      <div class="dialog-title">Справка</div>
      <div class="dialog-text">
        <p><b>Изображения:</b> в одной серии может быть несколько листов, все они показываются вместе.</p>
        <p><b>Добавление открыток:</b> потяни рамку на изображении — появится карточка справа.</p>
        <p><b>Данные:</b> сохраняются на этом устройстве (IndexedDB). Для переноса используй Экспорт/Импорт.</p>
      </div>
      <div class="dialog-actions">
        <button class="btn primary" value="ok">Ок</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgThumbPos" class="dialog">
    <form method="dialog" class="dialog-card dialog-thumb">
      <div class="dialog-title">Позиция миниатюры</div>
      <div class="thumb-editor">
        <div class="thumb-frame" id="thumbFrame">
          <img id="thumbImage" alt="" draggable="false" />
        </div>
        <div class="zoom-controls">
          <button id="thumbZoomOut" class="zoom-btn" type="button" aria-label="Уменьшить">−</button>
          <input id="thumbZoom" class="zoom-slider" type="range" min="1" max="3" step="0.01" value="1" />
          <button id="thumbZoomIn" class="zoom-btn" type="button" aria-label="Увеличить">＋</button>
          <span id="thumbZoomValue" class="zoom-value">100%</span>
        </div>
        <div class="thumb-hint">Перетаскивай изображение, чтобы выбрать область миниатюры.</div>
      </div>
      <div class="dialog-actions">
        <button id="thumbReset" class="btn ghost" type="button">Сбросить</button>
        <button class="btn ghost" value="cancel" formnovalidate>Отмена</button>
        <button id="thumbSave" class="btn primary" value="ok">Сохранить</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgCoverPos" class="dialog">
    <form method="dialog" class="dialog-card dialog-cover">
      <div class="dialog-title">Позиция обложки</div>
      <div class="thumb-editor">
        <div class="cover-frame" id="coverFrame">
          <img id="coverImage" alt="" draggable="false" />
        </div>
        <div class="zoom-controls">
          <button id="coverZoomOut" class="zoom-btn" type="button" aria-label="Уменьшить">−</button>
          <input id="coverZoom" class="zoom-slider" type="range" min="1" max="3" step="0.01" value="1" />
          <button id="coverZoomIn" class="zoom-btn" type="button" aria-label="Увеличить">＋</button>
          <span id="coverZoomValue" class="zoom-value">100%</span>
        </div>
        <div class="thumb-hint">Перетаскивай изображение, чтобы выбрать область обложки.</div>
      </div>
      <div class="dialog-actions">
        <button id="coverReset" class="btn ghost" type="button">Сбросить</button>
        <button class="btn ghost" value="cancel" formnovalidate>Отмена</button>
        <button id="coverSave" class="btn primary" value="ok">Сохранить</button>
      </div>
    </form>
  </dialog>

  <script src="app.js" type="module"></script>
  <div class="version-badge" id="versionBadge">v0.4.2.3</div>
</body>
</html>
